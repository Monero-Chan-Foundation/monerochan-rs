syntax = "proto3";

package monerochan.network.v1;

enum ProofMode {
  PROOF_MODE_UNSPECIFIED = 0;
  PROOF_MODE_CORE = 1;
  PROOF_MODE_COMPRESSED = 2;
  PROOF_MODE_PLONK = 3;
  PROOF_MODE_GROTH16 = 4;
}

enum FulfillmentStrategy {
  FULFILLMENT_STRATEGY_UNSPECIFIED = 0;
  FULFILLMENT_STRATEGY_AUCTION = 1;
  FULFILLMENT_STRATEGY_HOSTED = 2;
}

enum JobStatus {
  JOB_STATUS_UNSPECIFIED = 0;
  JOB_STATUS_PENDING = 1;
  JOB_STATUS_RUNNING = 2;
  JOB_STATUS_SUCCEEDED = 3;
  JOB_STATUS_FAILED = 4;
}

message ClientAuth {
  string job_id = 1;      // UUID chosen by the SDK to bind the signature
  string nonce = 2;       // Random UUID to prevent replay
  int64 timestamp = 3;    // Unix seconds, reject if stale (>1h)
  bytes signature = 4;    // Ed25519 signature
}

message RequestProofRequest {
  string program_id = 1;
  bytes elf = 2;
  bytes stdin = 3;
  ProofMode proof_mode = 4;
  FulfillmentStrategy strategy = 5;
  optional uint64 timeout_secs = 6;
  bool skip_simulation = 7;
  optional uint64 cycle_limit = 8;
  optional uint64 gas_limit = 9;
  uint64 min_auction_period = 10;
  repeated bytes whitelist = 11;
  bytes auctioneer = 12;
  bytes executor = 13;
  bytes verifier = 14;
  bytes treasury = 15;
  optional uint64 max_price_per_pgu = 16;
  optional uint64 auction_timeout_secs = 17;
  optional string client_address = 18;  // Base58 Solana address (required unless fee exempt)
  optional ClientAuth client_auth = 19; // Required when client_address is present
}

message RequestProofResponse {
  string request_id = 1; // Network job ID (UUID) - main proof identifier
  string job_id = 2; // SP1 network request ID (hex string with 0x prefix) - for reference
  string explorer_url = 3; // URL to view the proof job in the explorer
}

message GetProofStatusRequest {
  string request_id = 1;
}

message GetProofStatusResponse {
  JobStatus status = 1;
  bytes proof = 2;
  string error_message = 3;
  string request_id = 4; // Network job ID (UUID)
}

service Network {
  rpc RequestProof(RequestProofRequest) returns (RequestProofResponse);
  rpc GetProofStatus(GetProofStatusRequest) returns (GetProofStatusResponse);
}

